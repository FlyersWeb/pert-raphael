/* pert-svg v0.1.0 2014-10-12 by @flyersweb */
Number.prototype.leftZeroPad=function(a){var b=Math.abs(this),c=Math.max(0,a-Math.floor(b).toString().length),d=Math.pow(10,c).toString().substr(1);return 0>this&&(d="-"+d),d+b},Raphael.fn.arrow=function(a,b,c,d,e){var f=Math.atan2(a-c,d-b);f=f/(2*Math.PI)*360;var g=this.path("M"+c+" "+d+" L"+(c-e)+" "+(d-e)+" L"+(c-e)+" "+(d+e)+" L"+c+" "+d).attr("fill","black").rotate(90+f,c,d),h=this.path("M"+a+" "+b+" L"+c+" "+d);return[h,g]},Raphael.fn.pertChart=function(a,b){var c=this,d=function(a,b,c){if(c||(c=0),null===a.parent)return c;for(var e in b)if(b[e].id==a.parent)return a=b[e],c++,d(a,b,c)},e=function(a,b,c,d,e,f,g,h,i){var j=g.getFullYear()+"-"+(g.getMonth()+1).leftZeroPad(2)+"-"+g.getDate().leftZeroPad(2),k=h.getFullYear()+"-"+(h.getMonth()+1).leftZeroPad(2)+"-"+h.getDate().leftZeroPad(2),l=b.name.length>10?b.name.substr(0,10)+"...":b.name,m=a.rect(c,d,e,f).toBack(),n=a.path("M"+c+" "+(d+30)+"H"+(c+e)),o=a.path("M"+c+" "+(d+60)+"H"+(c+e));i?(m.attr({stroke:"#ff0000"}),n.attr({stroke:"#ff0000"}),o.attr({stroke:"#ff0000"})):(m.attr({stroke:"#000000"}),n.attr({stroke:"#000000"}),o.attr({stroke:"#000000"})),a.text(c+10,d+15,"ID : "+b.id).attr({"text-anchor":"start","font-family":"Verdana, Arial, serif","font-size":"14"}),a.text(c+e/2,d+15,l).attr({"text-anchor":"start","font-family":"Verdana, Arial, serif","font-size":"14"}),a.text(c+10,d+15+30,"Begin : "+j).attr({"text-anchor":"start","font-family":"Verdana, Arial, serif","font-size":"11"}),a.text(c+(e-10),d+15+30,"Duration : "+b.duration).attr({"text-anchor":"end","font-family":"Verdana, Arial, serif","font-size":"11"}),a.text(c+10,d+15+60,"End : "+k).attr({"text-anchor":"start","font-family":"Verdana, Arial, serif","font-size":"11"})},f=function(a,c){if(c&&c.tasks){var f=function(a,b){var c=Math.floor(a),d=(a-c)*b,e=Math.floor(d),f=60*(d-e),g={days:c,hours:e,minutes:f};return g},g=220,h=90,i=c.tasks,j=d(i[i.length-1],i)+1,k=new Date(parseInt(c.begin)),l=new Date(parseInt(c.end)),m={id:0,name:"Start",duration:0,parent:null};e(a,m,10,10,g,h,k,k,!0);for(var n=new Date(parseInt(c.begin)),o={},p=new Date(parseInt(c.end)),q={},r=new Date(p),s=0,t={},u=i.length-1;u>=0;u--){var v=i[u],w=d(v,i);j!=w&&(s=0),v.duration>s?(s=v.duration,t[u]=!0,t[u+1]=!1):t[u]=!1,j!=w?(r=new Date(p),j=w):s=0;var x=f(v.duration,b);p.setDate(r.getDate()-x.days),p.setHours(r.getHours()-x.hours),p.setMinutes(r.getMinutes()-x.minutes),q[u]=new Date(p)}for(var u=0;u<i.length;u++){var v=i[u],y=f(v.duration,8);n.setDate(n.getDate()+y.days),n.setHours(n.getHours()+y.hours),n.setMinutes(n.getMinutes()+y.minutes),o[u]=new Date(n)}for(var u=0,z=0;u<i.length;u++,z++){var v=i[u],w=d(v,i);j!=w&&(z=0,j=w),e(a,v,10+(w+1)*(g+20),10+z*(h+20),g,h,o[u],q[u],t[u]),a.arrow(10+20*w+g*(w+1),10+h/2,(g+20)*(w+1)+10,10+h/2+z*h,4)}a.arrow(30+g+20*w+g*(w+1),10+h/2,10+(j+2)*(g+20),10+h/2,4);var A={id:0,name:"End",duration:0,parent:null};e(a,A,10+(j+2)*(g+20),10,g,h,l,l,!0)}};f(c,a)};